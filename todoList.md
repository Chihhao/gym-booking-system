# 預約系統開發藍圖 (v1)

本文檔旨在規劃與追蹤新版預約流程的開發任務。

## 核心使用者流程

1.  **畫面一：課程選擇頁**
    -   使用者瀏覽所有可選課程（如：瑜伽、皮拉提斯）。
    -   此頁面不顯示時間，只專注於課程內容。
    -   使用者點擊某個課程，進入下一步。

2.  **畫面二：時段選擇頁**
    -   顯示一個以七天為單位的時間網格（表格）。
    -   橫軸為未來七天，縱軸為 09:00 - 21:00 的小時單位。
    -   **格子狀態**：
        -   `🟢` **可預約**：該時段有課且未額滿。
        -   `❌` **已額滿**：該時段有課但已額滿。
        -   **空白/灰色**：該時段未開設課程。
    -   **行動裝置**：直接顯示七天，允許使用者水平滑動表格來查看所有日期。

3.  **預約動作**
    -   使用者點擊 `🟢` 綠色圈圈。
    -   跳出確認對話框：「確認預約？」。
    -   使用者點擊「確認」。
    -   系統向後端發送預約請求。
    -   **即時性處理**：後端在執行預約的當下，會再次驗證該時段名額。如果已被他人預約額滿，則回傳錯誤訊息給使用者。

---

## 後端開發任務 (Backend)

### API 設計

1.  **[ ] 取得所有課程列表**
    -   **Endpoint**: `GET /api/courses`
    -   **功能**: 回傳所有課程的基本資訊。
    -   **Response Body**:
        ```json
        [
          { "id": 1, "name": "空中瑜伽", "description": "..." },
          { "id": 2, "name": "哈達瑜伽", "description": "..." }
        ]
        ```

2.  **[ ] 取得特定課程的週時間表**
    -   **Endpoint**: `GET /api/courses/{course_id}/schedule`
    -   **Query Params**: `start_date` (e.g., `2023-11-20`)
    -   **功能**: 根據課程 ID 和起始日期，回傳未來七天的時段狀態。
    -   **Response Body**:
        ```json
        {
          "2023-11-20": {
            "09:00": { "status": "available", "schedule_id": 101 },
            "10:00": { "status": "full", "schedule_id": 102 },
            "11:00": { "status": "no_class" }
          },
          "2023-11-21": { ... }
        }
        ```

3.  **[ ] 建立一筆新的預約**
    -   **Endpoint**: `POST /api/bookings`
    -   **功能**: 處理使用者的預約請求。
    -   **核心邏輯**:
        -   接收 `schedule_id`。
        -   在資料庫交易 (transaction) 中，再次檢查該 `schedule_id` 的剩餘名額。
        -   若有名額：建立預約紀錄，更新已預約人數，回傳成功。
        -   若已額滿：不建立預約，回傳 `409 Conflict` 錯誤及提示訊息（例如：「抱歉，此時段剛剛額滿」）。
    -   **Request Body**:
        ```json
        {
          "schedule_id": 101
        }
        ```

---

## 前端開發任務 (Frontend)

1.  **[ ] 建立課程選擇頁面 (`/courses`)**
    -   呼叫 `GET /api/courses` API。
    -   將課程以卡片或列表形式渲染出來。
    -   每個課程項目點擊後，導航至時段選擇頁，並帶上 `course_id`。

2.  **[ ] 建立時段選擇頁面 (`/courses/{course_id}/schedule`)**
    -   從 URL 取得 `course_id`。
    -   呼叫 `GET /api/courses/{course_id}/schedule` API。
    -   根據回傳的資料，渲染出 7x12 的時間網格。
    -   為表格容器添加 CSS，使其在小螢幕上可以水平滾動 (`overflow-x: auto`)。
    -   處理不同時段狀態的顯示樣式（綠圈、灰叉、空白）。

3.  **[ ] 開發預約互動功能**
    -   為綠色圈圈格子綁定點擊事件。
    -   點擊後，顯示一個原生的 `confirm()` 或自訂的 Modal 對話框。
    -   若使用者確認，則呼叫 `POST /api/bookings` API，並傳入該時段的 `schedule_id`。
    -   **錯誤處理**：如果 API 回傳 409 錯誤，需顯示清晰的提示訊息給使用者。
    -   **成功處理**：顯示成功訊息，並可選擇性地將剛剛點擊的格子狀態更新為已預約（例如變成一個打勾圖示），或直接導向「我的預約」頁面。