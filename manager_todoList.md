# 健身房管理後台開發任務清單

本文檔旨在規劃一個功能完整的管理後台，取代現有的 `admin.html`，並提供全面的系統管理能力。

---

## Phase 1: 基礎架構與強化的預約管理

**目標：** 建立一個新的 `manager.html` 頁面，作為所有後台功能的入口，並首先實作一個比現有 `admin.html` 更強大的預約管理介面。

### 前端任務 (manager.html)

-   **[ ] 建立基本頁面佈局 (`manager.html`)**
    -   [ ] 設計一個包含「側邊導覽列」和「主要內容區」的版型。
    -   [ ] 側邊欄應包含連結：`預約管理`、`課表管理`、`課程型錄`、`使用者管理`、`教練管理`。
    -   [ ] 初始狀態下，點擊連結會顯示 "功能開發中"。

-   **[ ] 實作登入驗證**
    -   [ ] 頁面載入時，跳出一個 `prompt()` 要求輸入密碼。
    -   [ ] 驗證成功才顯示內容，失敗則顯示錯誤訊息。
    -   *(未來可升級為更安全的 Google 帳號登入)*

-   **[ ] 開發「預約管理」介面**
    -   [ ] 呼叫後端 API (`getAllBookings`) 取得所有預約資料。
    -   [ ] 將預約資料以「表格」形式顯示。
    -   [ ] 表格欄位應包含：`預約編號`、`課程名稱`、`上課時間`、`學員`、`預約時間`、`狀態`、`操作`。
    -   [ ] **加入篩選功能**：
        -   [ ] 一個下拉選單，可依 `狀態` (`已預約`, `已扣款`, `已取消`) 篩選。
        -   [ ] 一個日期選擇器，可篩選特定 `上課日期` 的預約。
    -   [ ] **加入搜尋功能**：
        -   [ ] 一個輸入框，可依 `學員名稱` 或 `預約編號` 進行搜尋。
    -   [ ] **強化操作按鈕**：
        -   [ ] 對於「已預約」的單據，顯示 `確認扣款` 和 `取消預約` 按鈕。
        -   [ ] 對於已完成或已取消的單據，按鈕應為禁用(disabled)狀態。

### 後端任務 (Code.gs)

-   **[ ] 建立 `getAllBookings` API**
    -   [ ] 建立一個新的 API `action=getAllBookings`。
    -   [ ] 此 API 應能接收篩選條件（如 `status`, `date`, `query`）。
    -   [ ] 根據篩選條件，從 `Bookings` 工作表讀取並回傳對應的資料。
    -   [ ] **效能考量**：回傳的資料應包含所有前端需要的資訊（透過關聯 `Classes`, `Users` 等工作表），避免前端多次請求。

-   **[ ] 調整 `reviewBooking` API**
    -   [ ] 維持現有功能，供「確認扣款」和「取消預約」按鈕使用。

---

## Phase 2: 課表管理 (視覺化排課)

**目標：** 讓管理者能透過視覺化介面（例如日曆或表格）來新增、修改、刪除 `Classes` 工作表中的課程安排。

### 前端任務 (manager.html)

-   **[ ] 開發「課表管理」介面**
    -   [ ] 顯示一個類似 `schedule.html` 的週/月曆網格。
    -   [ ] 網格中應顯示已安排的課程，並標示 `課程名稱`、`教練`、`人數(已預約/上限)`。
    -   [ ] 點擊空白格子，應跳出一個表單(Modal)，讓管理者可以「新增課程」。
        -   表單包含：選擇 `課程型錄` (下拉選單)、選擇 `教練` (下拉選單)、設定 `人數上限`。
    -   [ ] 點擊已存在的課程，應跳出表單，可「修改」或「刪除」該課程。

### 後端任務 (Code.gs)

-   **[ ] 建立 `getClassesForManager` API**
    -   [ ] 回傳課表資料，包含所有必要資訊以便在日曆上渲染。

-   **[ ] 建立 `createClass` API**
    -   [ ] 接收前端表單傳來的資料，在 `Classes` 工作表中新增一筆紀錄。

-   **[ ] 建立 `updateClass` API**
    -   [ ] 接收要修改的 `class_id` 和新資料，更新對應的紀錄。

-   **[ ] 建立 `deleteClass` API**
    -   [ ] 接收 `class_id`，刪除 (或標記為已取消) 對應的課程。
    -   **注意**：需考慮若該課程已有預約時的處理邏輯（例如：是否要一併取消預約並通知使用者）。

---

## Phase 3: 核心資源管理 (CRUD)

**目標：** 為 `課程型錄`、`使用者`、`教練` 提供完整的增刪改查 (CRUD) 管理介面。

### 前端任務 (manager.html)

-   **[ ] 開發「課程型錄」管理介面**
    -   [ ] 顯示 `Courses` 列表，包含 `新增`、`編輯` 按鈕。
    -   [ ] 點擊按鈕後，透過表單(Modal)進行操作。

-   **[ ] 開發「使用者」管理介面**
    -   [ ] 顯示 `Users` 列表，可搜尋使用者。
    -   [ ] 點擊使用者可查看詳細資料及其所有預約紀錄。

-   **[ ] 開發「教練」管理介面**
    -   [ ] 顯示 `Coaches` 列表，包含 `新增`、`編輯` 按鈕。

### 後端任務 (Code.gs)

-   **[ ] 為 `Courses`, `Users`, `Coaches` 建立對應的 CRUD API**
    -   `getCourses`, `createCourse`, `updateCourse`, `deleteCourse`
    -   `getUsers`, `updateUser`
    -   `getCoaches`, `createCoach`, `updateCoach`, `deleteCoach`

---

## 待辦事項 & 建議

-   **優先級**：建議從 **Phase 1** 開始，因為這是最核心、最能立即改善管理流程的功能。
-   **元件化**：在開發過程中，可以將重複使用的 UI 元件（如 Modal 彈窗、表格生成器）抽象成共用函式，以簡化程式碼。
-   **安全性**：目前的密碼驗證只是臨時方案，未來應考慮整合 Google Sign-In，只允許授權的 Google 帳號登入後台。