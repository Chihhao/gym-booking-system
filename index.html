<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WALLY 自由教練工作室 - 首頁</title>
    <style>
        :root {
            /* --- 主題色 --- */
            --theme-yellow: #fcc419;
            --theme-yellow-hover: #ffd43b;
            --text-on-yellow: #212529;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            margin: 0;
            background-color: #212529;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            height: 100dvh; /* 使用動態可視高度，解決手機瀏覽器捲軸問題 */
            overflow: hidden; /* 隱藏所有溢出的內容，移除捲軸 */
        }

        .social-icon {
            color: #ffffff;
            text-decoration: none;
            transition: transform 0.2s, color 0.2s;
            display: inline-block; /* 讓 transform 生效 */
        }
        .social-icon:hover {
            transform: scale(1.1);
            color: var(--theme-yellow); /* 滑鼠懸停時變為主題黃色 */
        }
        .social-icon svg {
            width: 28px; /* 設定圖示大小 */
            height: 28px;
        }

        .hero { 
            position: relative;
            overflow: hidden; /* 關鍵：隱藏模糊效果的邊緣 */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
        }

        /* 新增：使用偽元素來專門處理背景圖和模糊效果 */
        .hero::before {
            content: '';
            position: absolute;
            top: -10px; right: -10px; bottom: -10px; left: -10px; /* 放大偽元素以避免模糊邊緣 */
            z-index: 1;
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('images/cover.jpeg');
            background-size: cover;
            background-position: center;
            filter: blur(3px); /* 加上模糊效果 */
        }

        .hero > * {
            position: relative; /* 確保內容在遮罩之上 */
            z-index: 2;
        }

        h1 {
            color: #ffffff;
            font-size: 3rem; /* 恢復原來的字體大小 */
            margin: 0 0 0.5rem 0;
            font-weight: 700;
        }

        p {
            color: #b0b0b0;
            font-size: 1.25rem;
            margin-bottom: 2rem;
        }

        /* 新增：主按鈕下方的社群圖示容器 */
        .social-links {
            margin-top: 2.5rem; /* 與上方按鈕的間距 */
            display: flex;
            gap: 1.5rem; /* 圖示之間的間距 */
            align-items: center;
        }

        /* 新增：獨立的分隔線樣式 */
        .separator {
            width: 1px;
            background-color: rgba(255, 255, 255, 0.5); /* 使用半透明白色 */
            height: 24px; /* 讓分隔線與圖示同高 */
        }
        .btn {
            display: inline-block;
            padding: 1rem 2.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            text-decoration: none;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary { 
            background-color: var(--theme-yellow); /* 使用主題黃色 */
            color: var(--text-on-yellow);
        }

        .btn-primary:hover {
            background-color: var(--theme-yellow-hover); /* 滑鼠懸停時的亮黃色 */
        }

        /* 新增：放在圖片左下角的聯絡資訊 */
        .contact-info {
            position: absolute;
            bottom: 1.5rem;
            left: 50%; /* 水平置中第一步：移到 50% 位置 */
            transform: translateX(-50%); /* 水平置中第二步：向左移自身寬度的一半 */
            width: 90%; /* 增加寬度以避免文字換行 */
            z-index: 2;
            text-align: center; /* 文字水平置中 */
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6; /* 調整行高以增加可讀性 */
        }
        .contact-info p {
            margin: 0; /* 覆蓋 p 的預設樣式 */
        }

        .desktop-only-space {
            display: inline; /* 或不寫，因為 span 預設就是 inline */
        }
        
        .mobile-only-break {
            display: none; /* 在桌面版預設隱藏 */
        }
        
        /* 響應式設計：在小螢幕上調整字體大小 */
        @media (max-width: 600px) {
            h1 {
                font-size: 2.5rem; /* 恢復手機版的字體大小 */
            }
            p {
                font-size: 1.1rem;
            }
            .btn {
                padding: 0.8rem 2rem;
                font-size: 1.1rem;
            }
            .social-icon svg {
                width: 24px;
                height: 24px;
            }
            .contact-info {
                font-size: 0.75rem;
                bottom: 1rem;
            }
            .desktop-only-space {
                display: none; /* 在手機版隱藏這個空格 */
            }
            .mobile-only-break {
                display: block; /* 在手機版顯示為區塊元素，強制換行 */
            }
        }
    </style>
</head>
<body>
    <main class="hero">
        <h1>WALLY<span class="desktop-only-space"> </span><br class="mobile-only-break">自由教練工作室</h1>
        <p>打造理想體態，從這裡開始。</p>
        <!-- 關鍵修正：移除預設的 href，避免 LIFF SDK 在初始化時掃描到並產生警告。
             href 將完全由下方的 JavaScript 動態設定。
             設定 href="javascript:void(0);" 是一個安全的做法，表示點擊後不執行任何操作。 -->
        <a href="javascript:void(0);" class="btn btn-primary">立即預約課程</a>
        <div class="social-links">
            <a href="https://www.threads.net/@freecoachwally" target="_blank" rel="noopener noreferrer" class="social-icon" title="前往 Threads">
                <!-- 更換為 @ 符號圖示 -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="4"></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"></path>
                </svg>
            </a>
            <a href="https://www.instagram.com/freecoachwally/" target="_blank" rel="noopener noreferrer" class="social-icon" title="前往 Instagram">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
            </a>
            <div class="separator"></div>
            <!-- 新增：管理者登入圖示 -->
            <a href="manager.html" class="social-icon" title="管理者後台">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle>
                </svg>
            </a>
        </div>
        <div class="contact-info">
            <p>0937-402-893</p>
            <p>新竹市中華路二段 625 號 2 樓</p>
        </div>
    </main>

    <!-- 載入共用設定檔 -->
    <script src="config.js"></script>
    <!-- 載入 LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        /**
         * 整合後的 LIFF 初始化與路由函式
         * 1. 初始化 LIFF。
         * 2. 檢查 liff.state，如果存在，則跳轉到目標頁面 (例如從 LINE Bot 點擊憑證連結)。
         * 3. 如果不存在 liff.state，則正常顯示首頁，並根據環境 (LINE App 或外部瀏覽器) 設定「立即預約」按鈕的正確連結。
         */
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('version: 2025-10-06a');
            
            const urlParams = new URLSearchParams(window.location.search);
            const debugMode = urlParams.get('debug') === 'true';
            const bookingLink = document.querySelector('a.btn-primary');

            // 根據 debug 模式組合查詢字串
            const debugQuery = debugMode ? '?debug=true' : '';
            const debugQueryWithAnd = debugMode ? '&debug=true' : '';

            try {
                // --- 診斷日誌：在 init 之前 ---
                console.log('[Liff-Diag] --- Before liff.init() ---');
                console.log(`[Liff-Diag] window.location.href: ${window.location.href}`);
                console.log(`[Liff-Diag] LIFF ID: ${AppConfig.LIFF_ID}`);
                // 檢查 LIFF SDK 物件本身是否存在，以及是否有任何可疑的初始狀態
                console.log('[Liff-Diag] liff object:', liff);
                console.log(`[Liff-Diag] liff.state before init: ${liff.state}`);

                // 終極解決方案：在 index.html 中，為 liff.init() 加上 withLogin: false。
                // 這會強制 LIFF SDK 重新驗證當前的 URL (根路徑)，並用它來覆蓋 localStorage 中
                // 記憶的舊路徑 (例如 /courses.html)，從而從根本上消除警告。
                // 這並不會強制使用者登入，只是觸發了 SDK 內部的路徑重置邏輯。
                await liff.init({
                    liffId: AppConfig.LIFF_ID,
                    withLogin: false
                });

                // --- 診斷日誌：在 init 之後 ---
                console.log('[Liff-Diag] --- After liff.init() ---');
                console.log(`[Liff-Diag] liff.getOS(): ${liff.getOS()}`);
                console.log(`[Liff-Diag] liff.isInClient(): ${liff.isInClient()}`);
                console.log(`[Liff-Diag] liff.isLoggedIn(): ${liff.isLoggedIn()}`);
                console.log(`[Liff-Diag] liff.state after init: ${liff.state}`);

                // 檢查 liff.state，這通常來自於從 LINE Bot 點擊的 LIFF URL
                // 例如：liff.line.me/LIFF_ID?liff.state=/booking-details.html?id=...
                const path = liff.state; // liff.state 只有在透過 liff.line.me/... 帶參數進來時才會有值

                if (path) {
                    // --- 情況 1: 有 liff.state，執行跳轉 ---
                    console.log(`LIFF state detected: ${path}. Redirecting...`);
                    
                    const baseUrl = window.location.origin + window.location.pathname.replace(/index\.html$/, '');
                    const finalPath = path.includes('?') 
                                    ? `${path}${debugQueryWithAnd}` // 如果有，用 & 附加 debug 參數
                                    : `${path}${debugQuery}`;      // 如果沒有，用 ? 附加 debug 參數

                    window.location.replace(baseUrl + finalPath);
                    // 因為即將跳轉，後續程式碼不會執行
                } else {
                    // --- 情況 2: 沒有 liff.state，設定按鈕連結 ---
                    // 關鍵修正：將 href 的設定邏輯移到這個 else 區塊，確保只有在不需要跳轉時才設定。
                    setBookingLinkHref();
                    // 註：按鈕連結已在 liff.init() 後設定，此處僅保留日誌
                    console.log('No LIFF state. Setting up index page button.');
                }
            } catch (error) {
                console.error('LIFF initialization failed on index.html:', error);
                // 即使 LIFF 初始化失敗，也要確保按鈕有備用連結
                // 由於 liff.init() 失敗，我們無法判斷 liff.isInClient()，因此直接給一個最安全的外部瀏覽器連結。
                setBookingLinkHref(true); // 傳入 true 表示強制使用外部連結
            }

            // 新增：將設定連結的邏輯封裝成一個函式
            function setBookingLinkHref(forceExternal = false) {
                // 終極解決方案：將路徑字串拆分，避免 LIFF SDK 在初始化時進行靜態掃描並產生誤判。
                // 透過變數組合，'courses.html' 這個完整的字串只會在函式執行時才被組合出來。
                const pageName = 'courses';
                const fileExtension = '.html';
                if (!forceExternal && liff.isInClient()) {
                    bookingLink.href = `https://liff.line.me/${AppConfig.LIFF_ID}/${pageName}${fileExtension}${debugQuery}`;
                } else {
                    bookingLink.href = `${pageName}${fileExtension}${debugQuery}`;
                }
            }
        });
    </script>
</body>
</html>
